Suppose, we know the signal value of a sinusoid y0 at some sample instant n0: y0 = y[n0] and its 
right neighbour yR = y[n0+1] and we also know the normalized radian frequency w of the sine. We 
want to compute its instantaneous amplitude a and phase p at n0, so we need solve the nonlinear 
system of 2 equations:

  y0 = a * sin(p)
  yR = a * sin(p+w)
  
with known y0, yR, w for a and p. It's actually nonlinear only in p, so that's the difficult 
variable. Once p is known, we can compute a like:

  a = y0 / sin(p) = yR / sin(p+w)
  
which of the two possible equations is used should depend on in which case we get a nonzero 
denominator. To find p, we use the addition theorem:

  sin(p+w) = sin(p)*cos(w) + cos(p)*sin(w)
  
which gives:
  
  y0 / sin(p) = yR / ( sin(p)*cos(w) + cos(p)*sin(w) )
  
  sin(p) / y0 = ( sin(p)*cos(w) + cos(p)*sin(w) ) / yR    | / sin(p), * yR
  yR/y0 = ( sin(p)*cos(w) + cos(p)*sin(w) ) / sin(p)
  yR/y0 = sin(p)*cos(w)/sin(p) + cos(p)*sin(w)/sin(p)
  yR/y0 = cos(w) + cos(p)*sin(w)/sin(p)
  yR/y0 - cos(w) = cos(p)*sin(w)/sin(p)
  yR/y0 - cos(w) = sin(w)/tan(p)
  tan(p) = sin(w) / (yR/y0 - cos(w))
  
We finally arrive at:
  
  p = atan2(sin(w), yR/y0 - cos(w))         | multiply both arguments by y0 - does not change the angle
    = atan2(y0*sin(w), yR - y0*cos(w))

Instead of the current value y0 and its right neighbour yR, we could also have used y0 and its left
neighbour - let's denote it by yL - getting a backward looking formula:

  yL = a * sin(p-w)
  y0 = a * sin(p)

The addition theorem works also with both plusses replaced by minusses, so:

  p = atan2(-y0*sin(w), yL - y0*cos(w))





